# Документация по основным аспектам работы приложения

## Архитектура и структура

### Feature-Sliced Design
- Разделение кода по фичам, сущностям, shared-компонентам, процессам и виджетам
- Atomic Design: UI-компоненты делятся на атомы, молекулы, организмы
- Разделение бизнес-логики и UI: бизнес-логика реализуется через хуки (model), UI — через чистые компоненты (ui)
- Переиспользуемость: все общие компоненты и утилиты вынесены в shared

### Структура src
```
src/
  app/                # Глобальные провайдеры, настройки
  entities/           # Сущности (user, district, gender) с api, service, model, types
  features/           # Фичи (auth и др.), каждая — отдельная папка с ui и model
  pages/              # Страницы (LoginPage, RegisterPage, ...)
  shared/             # Общие компоненты, хуки, утилиты, конфиги
    components/
      atoms/
      molecules/
      organisms/
    hooks/
    utils/
    config/
  widgets/            # Крупные виджеты, собирающие фичи и shared-компоненты
  processes/          # Сложные бизнес-процессы
```

---

## Механизм авторизации и безопасности

### Основные компоненты
- **tokenService** — управление токенами, проверка валидности, извлечение информации о пользователе
- **tokenAPI** — API для работы с токенами, автоматическое обновление, обработка ошибок
- **authService** — бизнес-логика авторизации, интеграция с API, управление состоянием пользователя
- **useAuth** — хук для управления авторизацией, централизованное состояние, автоматическая проверка токенов
- **AuthContext** — глобальный React Context для авторизации

### Функциональность
- Автоматическое обновление токенов (TokenRefreshManager)
- Проверка токенов каждые 4 минуты, обновление за 5 минут до истечения
- Очередь запросов при одновременном обновлении токенов
- Безопасное хранение токенов в localStorage
- Проверка структуры JWT, валидация срока действия с буфером времени
- Автоматическая очистка токенов при ошибках
- Детальная обработка ошибок API
- Логирование ошибок для отладки

### API Endpoints
- POST /api/token/ — авторизация
- POST /api/token/refresh/ — обновление токена
- POST /api/token/verify/ — проверка токена

---

## Защита маршрутов (роутинг)

### Типы маршрутов
- **Защищённые** (`protected: true`): требуют авторизации, редиректят на /login неавторизованных
- **Публичные** (`public: true`): доступны только неавторизованным, авторизованных редиректят на главную
- **Обычные**: доступны всем

### Компоненты
- **ProtectedRoute** — защищает маршруты от неавторизованных пользователей, показывает AuthLoader, редиректит на /login
- **PublicRoute** — защищает публичные страницы от авторизованных, редиректит на главную
- **AuthRedirectHandler** — глобальный обработчик редиректов, работает в фоне

### Пример конфигурации маршрутов
```js
export const routes = [
  { path: '/', element: <MainPage />, protected: true },
  { path: '/login', element: <LoginPage />, public: true },
  { path: '/register', element: <RegisterPage />, public: true },
  { path: '/doctors', element: <DoctorsPage />, protected: true },
];
```

### Логика редиректов
- Неавторизованный: попытка доступа к защищённой странице → /login
- Авторизованный: попытка доступа к публичной странице → /
- После успешной авторизации — возврат на исходную страницу
- Несуществующий маршрут: редирект на /login или /

---

## Цветовая схема и дизайн

### Принципы дизайна

#### 1. Многослойность (Layering)
- **Основной фон**: `#FAFAFA` - слегка серый для создания глубины
- **Шапка**: `#FFFFFF` с тенью и границей
- **Сайдбар**: `#FFFFFF` с тенью и границей
- **Контент**: `#FFFFFF` с легкими тенями

#### 2. Иерархия цветов
```
Самый светлый → Самый темный
#FFFFFF (белый) → #FAFAFA (фон) → #F8F9FA (вторичный фон)
```

#### 3. Эффекты объема
- **Тени**: Многоуровневые тени для создания глубины
- **Градиенты**: Тонкие градиенты для объема
- **Границы**: Различные оттенки для разделения слоев

### Цветовая палитра

#### Основные цвета
```javascript
primary: '#2563eb'        // Основной синий
secondary: '#6B7280'      // Вторичный серый
accent: '#F59E0B'         // Акцентный оранжевый
```

#### Фоновые цвета (многослойность)
```javascript
background: '#FAFAFA'           // Основной фон приложения
backgroundSecondary: '#F8F9FA'  // Вторичный фон
backgroundTertiary: '#F5F6F7'   // Третичный фон
```

#### Компоненты интерфейса
```javascript
header: '#FFFFFF'               // Шапка - белая
sidebar: '#FFFFFF'              // Боковое меню - белое
card: '#FFFFFF'                 // Карточки
cardHover: '#F8F9FA'           // Карточки при наведении
```

### Эффекты и тени

#### Тени для компонентов
```javascript
header: '0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03)'
sidebar: '2px 0 8px -2px rgba(0, 0, 0, 0.06)'
card: '0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03)'
cardHover: '0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04)'
```

#### Состояния взаимодействия
```javascript
hover: {
  primary: '#1D4ED8',    // Темнее основного
  secondary: '#4B5563',  // Темнее вторичного
  surface: '#F8F9FA',    // Светло-серый
}

active: {
  primary: '#1E40AF',    // Еще темнее
  secondary: '#374151',  // Еще темнее
  surface: '#F3F4F6',    // Более серый
}

focus: {
  primary: '#3B82F6',    // Яркий синий
  secondary: '#6B7280',  // Средний серый
}
```

### Применение в компонентах

#### Header (Шапка)
- Фон: `#FFFFFF` (белый)
- Тень: `header` shadow
- Граница снизу: `borderLight`
- Z-index: `1000`

#### Sidebar (Боковое меню)
- Фон: `#FFFFFF` (белый)
- Тень: `sidebar` shadow
- Граница справа: `borderLight`
- Z-index: `900`

#### Main Content (Основной контент)
- Фон: `#FAFAFA`
- Карточки: `#FFFFFF` с `card` shadow
- При наведении: `cardHover` shadow

#### MenuItem (Пункты меню)
- Цвет текста: `text`
- При наведении: `hover.surface` + `primary` цвет
- Анимация: `translateX(4px)` + тень
- Иконки: `scale(1.05)` при наведении

### Страницы авторизации

#### Фон страниц
- **LoginPage** и **RegisterPage** используют фон приложения (`#FAFAFA`)
- Убраны градиенты, создан единообразный дизайн

#### Формы
- **BaseForm** использует белый фон (`#FFFFFF`)
- Добавлены тени и границы для лучшего выделения
- Создан контраст с серым фоном страниц

#### Цветовая схема страниц авторизации
```
Фон страниц: #FAFAFA (серый)
Формы: #FFFFFF (белый)
Тени: card shadow
Границы: borderLight
```

---

## Безопасность
- Все защищённые маршруты проверяют авторизацию
- Даже при прямом вводе URL неавторизованные перенаправляются
- Информация о том, откуда пришёл пользователь, сохраняется в state
- После авторизации пользователь возвращается на исходную страницу
- При ошибках авторизации — редирект на логин, токены очищаются
- Для production рекомендуется использовать httpOnly cookies

---

## Преимущества реализации

### 1. Улучшенная навигация
- Четкое разделение между шапкой, меню и контентом
- Пользователь всегда понимает, где находится
- Интуитивно понятная иерархия

### 2. Лучший UX
- Плавные переходы и анимации
- Отзывчивые эффекты наведения
- Доступность (focus состояния)
- Консистентный дизайн по всему приложению

### 3. Профессиональный вид
- Современный дизайн с глубиной
- Консистентная цветовая схема
- Высокое качество визуального восприятия

### 4. Единообразие
- Все страницы используют одинаковый фон
- Белые формы четко выделяются на сером фоне
- Пользователь не теряется при переходах между страницами

---

## Отладка

### Проверка авторизации
```javascript
import tokenService from './entities/user/tokenService';
console.log('Access token valid:', tokenService.isAccessTokenValid());
console.log('Refresh token valid:', tokenService.isRefreshTokenValid());
```

### Проверка состояния авторизации
```javascript
import { useAuthContext } from '../features/auth/model/AuthContext';
const { isAuthenticated, user, loading } = useAuthContext();
```

### Проверка цветов
```javascript
// Проверка текущих цветов
console.log('Background:', theme.colors.background);
console.log('Header:', theme.colors.header);
console.log('Sidebar:', theme.colors.sidebar);

// Проверка теней
console.log('Header shadow:', theme.shadow.header);
console.log('Sidebar shadow:', theme.shadow.sidebar);
```

---

## Лучшие практики

### Авторизация и безопасность
1. Всегда используйте ProtectedRoute для защищённых страниц
2. Используйте PublicRoute для страниц авторизации
3. Проверяйте состояние авторизации в компонентах
4. Обрабатывайте ошибки авторизации
5. Используйте AuthLoader для лучшего UX

### Дизайн и UX
1. **Используйте правильные цвета для состояний**
   - Hover: `hover.surface`
   - Active: `active.surface`
   - Focus: `focus.primary`

2. **Применяйте тени для создания глубины**
   - Компоненты: `card` shadow
   - При наведении: `cardHover` shadow
   - Шапка: `header` shadow
   - Меню: `sidebar` shadow

3. **Используйте градиенты для объема**
   - Поверхности: `surfaceGradient`
   - Фон: `backgroundGradient`

4. **Соблюдайте иерархию**
   - Самый важный контент на самом светлом фоне
   - Вторичный контент на более темном фоне
   - Фон приложения самый темный из белых

### Общие принципы
1. Документируйте архитектурные решения
2. Пишите тесты для бизнес-логики и UI
3. Следуйте принципам Feature-Sliced Design
4. Используйте Atomic Design для компонентов
5. Обеспечивайте переиспользуемость кода 